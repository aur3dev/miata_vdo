#include <stdio.h>
#include "Arduino.h"
#include <avr/power.h>
#include <SoftwareSerial.h>
#include <DHT.h>
#include <Adafruit_Sensor.h>

//dht pin
#define DHTPIN_out 2 //on digital PIN D2
#define DHTPIN_in 3

//bluetooth pin
#define TX 11
#define RX 10

//dht object
#define DHTTYPE DHT22   // DHT 22  (AM2302)

//bluetooth object


//dht sensor declaration
DHT sensorOut(DHTPIN_out, DHTTYPE);
DHT sensorIn(DHTPIN_in, DHTTYPE);


double humidityOut, temperatureOut, humidityIn, temperatureIn;

String tempInSend,humidInSend,tempOutSend;
void temp();
void writeToBTSerialOutput();
void setup() {

	Serial.begin(9600);
	sensorOut.begin();
	sensorIn.begin();
}
void loop() {

temp();
}
void temp() {
	humidityOut = sensorOut.readHumidity();
			temperatureOut = sensorOut.readTemperature();

			humidityIn = sensorIn.readHumidity();
			temperatureIn = sensorIn.readTemperature();
			//writeToBTSerialOutput();
			String tram = "#"+String(humidityOut)+"|"+String(humidityIn)+"|"+String(temperatureOut)+"|";
			//String tram = "#"+String(humidityOut)+"|"+String(humidityIn)+"|";
			Serial.print(tram);
			//print log on console
			//Serial.print("Humidity Out: ");
			//Serial.print(" \t ");
			//Serial.print("Temperature Out: ");
		//	Serial.print(temperatureOut);
			//Serial.println(" *C");
			//Serial.println("-----------------------------------------------------");
			//Serial.print("Humidity In: ");
			//Serial.print(humidityIn);
			//Serial.print("\t");
			//Serial.print("Temperature In: ");
		//	Serial.print(temperatureIn);
		//	Serial.println(" *C ");

			delay(1000);
}

void writeToBTSerialOutput() {
  const unsigned int OUTPUT_SIZE = 21; // extend this when adding more values
  char outputString[OUTPUT_SIZE];
  char floatBuffer1[6] = {'\0','\0','\0','\0','\0','\0'}; // 4 digits, the dot and \0
  char floatBuffer2[6] = {'\0','\0','\0','\0','\0','\0'}; // 4 digits, the dot and \0
  char floatBuffer3[6] = {'\0','\0','\0','\0','\0','\0'};
  snprintf(outputString, OUTPUT_SIZE, "%u|%u|%u|%u",
    //  gBatteryPercentage, gDisplay.getDutyCycle(),
      dtostrf(temperatureOut, 5, 1, floatBuffer1),
      dtostrf(temperatureIn, 5, 1, floatBuffer2),
      dtostrf(humidityIn, 5, 1, floatBuffer3)

); // null-termination is taken care of by snprintf()

  printf("Writing data to BT serial: \n");
  printf("%c",outputString);

  Serial.write(outputString, strnlen(outputString, OUTPUT_SIZE));
  Serial.flush(); // block until data sent
}

